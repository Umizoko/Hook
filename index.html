<DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>HOOK</title>
        <link href="css/style.css" rel="stylesheet">
    </head>

    <body>
        <header>
            <h1>HOOK</h1>
        </header>

        <div id="wrapper">
            <div id="chat_bord">
                <ul id="chat_list">
                    <li class="bot">こんにちは。</li>
                </ul>
            </div>

            <div>
                <form action="#" id="form">
                    <input type="text" name="word">
                    <input type="submit" value="送信">
                </form>
            </div>
        </div>

        <footer>
        </footer>

        <script
        src="http://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
        crossorigin="anonymous"></script>

        <script>
            $(document).ready(function(){
                var sendUrl = "https://api.a3rt.recruit-tech.co.jp/talk/v1/smalltalk";
                var apiKey = "";
                var recieveChat = function(query){
                    var text = "";
                        $.ajax({
                        url: sendUrl,
                        type: "POST",
                        dataType: "json",
                        data : {
                            "apikey": apiKey,
                            "query": query
                        },
                    })
                    .done(function(data){
                        // console.log(data);
                        // bot側のメッセージをhtmlに表示
                        var bot_message = data.results[0].reply;
                        var list = document.createElement("li");
                        var tag_list = document.getElementById("chat_list").appendChild(list);
                        tag_list.classList.add("bot");
                        tag_list.textContent = bot_message;  
                    })
                    .fail(function(){
                        window.alert("error");
                    });
                }

                // submit event -> chatAPIを送信
                document.getElementById("form").onsubmit = function(){

                    // user側のメッセージをhtmlに表示
                    var user_message = document.getElementById("form").word.value;
                    var list = document.createElement("li");
                    var tag_list = document.getElementById("chat_list").appendChild(list);
                    tag_list.classList.add("user");
                    tag_list.textContent = user_message;

                    // TalkAPI
                    recieveChat(user_message);

                    // input textのvalueを消去
                    document.getElementById("form").word.value = "";
      
                    // 再更新を停止
                    return false;
                };

            });
        </script>
    </body>
</DOCTYPE>